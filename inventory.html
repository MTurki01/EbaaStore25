<!DOCTYPE html>
<html lang="ar">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta charset="utf-8">
<title>Ø§Ù„Ù…Ø®Ø²ÙˆÙ† - EbaaStore25</title>
<link rel="stylesheet" href="style.css">
<style>
:root{
  --main-purple: #6C4370;
  --accent: #87588A;
  --accent-2: #9F6D99;
  --accent-3: #B78AA7;
  --background: #E0C9C9;
  --text: #2b2b2b;
  --white: #ffffff;
}

*{box-sizing:border-box;}
body{
  margin:0;
  font-family:"Arial",sans-serif;
  background: var(--background);
  color: var(--text);
  display:flex;
  justify-content:center;
  padding:20px;
}
.wrapper{width:100%; max-width: 940px; text-align:center;}

/* Header + Navbar */
header{
  background: linear-gradient(90deg, var(--main-purple), var(--accent-2));
  padding: 18px;
  border-radius: 10px;
  margin-bottom: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.06);
}
header h1{ margin:0; color: #4e4e4e; font-size:26px; letter-spacing:0.5px; }
nav{ margin-top:10px; display:flex; flex-wrap:wrap; justify-content:center; gap:6px; }
nav a{
  color:#686868;
  text-decoration:none;
  margin:0;
  background: rgba(255,255,255,0.15);
  padding:8px 12px;
  border-radius:8px;
  font-weight:600;
  transition: all 0.2s ease;
}
nav a:hover{ background: rgba(255,255,255,0.3); transform: translateY(-1px); }

/* Section buttons (Ø§Ù„Ø£Ù‚Ø³Ø§Ù…) */
.section-buttons{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:8px;
  margin:12px 0;
}
.section-buttons button{
  background: var(--accent-2);
  border:none;
  color:white;
  padding:8px 14px;
  border-radius:8px;
  cursor:pointer;
  font-weight:600;
  transition: all 0.2s ease;
}
.section-buttons button:hover{ background: var(--accent-3); transform: translateY(-2px); }

/* Cards */
.card{
  background: #fff;
  padding:18px;
  border-radius:10px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.05);
  margin-bottom:18px;
  width:100%;
}

/* Inputs & Buttons */
.controls{ display:flex; flex-wrap:wrap; justify-content:center; gap:10px; margin-bottom:12px; }
input[type="text"], input[type="number"], input[type="file"]{
  padding:10px;
  border-radius:8px;
  border:1px solid #e6e6e6;
  flex: 1 1 150px;
  max-width:220px;
  text-align:center;
}
button.primary{
  background: var(--accent-2);
  border:none;
  color:white;
  padding:10px 16px;
  border-radius:8px;
  cursor:pointer;
  font-weight:600;
  flex:1 1 100px;
}
button.ghost{
  background:transparent;
  border:1px solid var(--accent);
  color:var(--accent);
  padding:8px 12px;
  border-radius:8px;
  cursor:pointer;
  transition: all 0.2s ease;
}
button.ghost:hover{
  background: var(--accent);
  color: var(--white);
}

/* Product grid */
.products-grid{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:14px;
  padding-top:8px;
}
.product{
  flex:1 1 160px;   /* ØªÙ… ØªØµØºÙŠØ±Ù‡ */
  max-width:160px;   /* ØªÙ… ØªØµØºÙŠØ±Ù‡ */
  background: var(--accent-2);
  color:#fff;
  border-radius:10px;
  padding:8px;       /* ØªÙ… ØªØµØºÙŠØ±Ù‡ */
  text-align:center;
  border:1px solid #87588A;
  display:flex;
  flex-direction: column;
  justify-content: space-between;
  font-size:13px;    /* Ù†Øµ Ø£ØµØºØ± */
}
.product h3{ margin:6px 0 4px 0; font-size:14px; }
.product p{ margin:4px 0; font-weight:600; }
.product .small{ font-size:12px; color:#f3e8f0; }

/* Quantity buttons */
.q-controls{
  display:flex;
  gap:6px;
  justify-content:center;
  margin-top:6px;
  flex-wrap:wrap;
}
.q-controls button{
  padding:4px 6px;   /* ØªÙ… ØªØµØºÙŠØ±Ù‡ */
  border-radius:6px;
  border:none;
  cursor:pointer;
  flex:1 1 40%;
  background:#fff;
  color: var(--accent-2);
  font-weight:600;
  font-size:12px;    /* ØªÙ… ØªØµØºÙŠØ±Ù‡ */
  transition: 0.2s;
}
.q-controls button:hover{ background: #f3e8f0; }

/* Responsive */
@media(max-width:768px){
  .controls{ flex-direction: column; align-items:center; }
  input, button.primary{ width: 90%; max-width:220px; }
  nav{ flex-direction: column; }
  .product{ flex:1 1 100%; max-width:100%; }
  .q-controls button{ flex:1 1 45%; margin-bottom:4px; }
}

@media(max-width:480px){
  header h1{ font-size:22px; }
  nav a{ padding:6px 10px; font-size:14px; }
  input, button{ padding:8px; font-size:14px; }
  .product{
    flex:1 1 45%;      /* ØµÙÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ù‡ÙˆØ§ØªÙ */
    max-width:45%;
    padding:6px;
    font-size:12px;
  }
  .product h3{ font-size:13px; margin:4px 0 2px 0; }
  .product p, .product .small{ font-size:11px; }
  .q-controls button{ padding:3px 5px; font-size:11px; }
  .products-grid{ gap:6px; } /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª */
}
.product-img{
  width:100%;
  height:120px;
  object-fit:cover;
  border-radius:8px;
  margin-bottom:6px;
  background:#fff;
}
#scrollTopBtn{
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  border: none;
  background: var(--main-purple);
  color: white;
  font-size: 20px;
  cursor: pointer;
  box-shadow: 0 4px 10px rgba(0,0,0,0.25);
  display: none;
  z-index: 999;
  transition: opacity 0.3s, transform 0.3s;
}
#scrollTopBtn:hover{
  background: var(--accent-2);
  transform: translateY(-3px);
}

.import-export-box{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:12px;
  margin-top:20px;
}
.secondary{
  background: var(--accent-2);
  border:none;
  color:white;
  margin:5px;
  padding:10px 16px;
  border-radius:8px;
  cursor:pointer;
  font-weight:600;
  flex:1 1 100px;
}


</style>
</head>
<body>
<div class="wrapper">
  <header class="card">
    <h1>Ø§Ù„Ù…Ø®Ø²ÙˆÙ† - EbaaStore25</h1>
    <nav>
      <a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
      <a href="inventory.html">Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</a>
      <a href="Orders.html">Ø§Ù„Ø·Ù„Ø¨ÙŠØ§Øª</a>
      <a href="finances.html">Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª ÙˆØ§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</a>
    </nav>
  </header>

  <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ù‚Ø³Ø§Ù… -->
  <div class="section-buttons">
    <button onclick="scrollToSection('Ø­Ù‚Ø§Ø¦Ø¨')">Ø­Ù‚Ø§Ø¦Ø¨</button>
    <button onclick="scrollToSection('Ù…ÙˆØ¨Ø§ÙŠÙ„')">Ù…ÙˆØ¨Ø§ÙŠÙ„</button>
    <button onclick="scrollToSection('Ø§ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª')">Ø§ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª</button>
    <button onclick="scrollToSection('Ù…ÙƒÙŠØ§Ø¬')">Ù…ÙƒÙŠØ§Ø¬</button>
    <button onclick="scrollToSection('Ù…Ù„Ø§Ø¨Ø³')">Ù…Ù„Ø§Ø¨Ø³</button>
    <button onclick="scrollToSection('Ø§Ù„Ù…Ù†Ø²Ù„')">Ø§Ù„Ù…Ù†Ø²Ù„</button>
    <button onclick="scrollToSection('Ø£ÙØ±Ø§Ø­')">Ø£ÙØ±Ø§Ø­</button>
    <button onclick="scrollToSection('Ø£Ø®Ø±Ù‰')">Ø£Ø®Ø±Ù‰</button>
  </div>

  <div class="card upload-area">
    <h3>Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù„Ù Excel (.xlsx)</h3>
    <input id="excelFile" type="file" accept=".xlsx,.xls" />
    <br/>
    <button onclick="importExcel()" class="primary">ğŸ“¤ Ø±ÙØ¹ ÙˆØ§Ø³ØªÙŠØ±Ø§Ø¯</button>
    <button onclick="exportToExcel()" class="secondary">ğŸ“¥ ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©</button>
    <p id="uploadMsg" class="alert"></p>
  </div>

  <div id="productsContainer"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
import { getDatabase, ref, push, set, onValue, remove, update } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDvz2YRGo4YVXIJPkeaquhKBBpr8Hia-PA",
  authDomain: "ebaastore25.firebaseapp.com",
  databaseURL: "https://ebaastore25-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "ebaastore25",
  storageBucket: "ebaastore25.firebasestorage.app",
  messagingSenderId: "204776755293",
  appId: "1:204776755293:web:05fb5690dfc7cc026b7db4"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const canonicalSections = ["Ø­Ù‚Ø§Ø¦Ø¨","Ù…ÙˆØ¨Ø§ÙŠÙ„","Ø§ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª","Ù…ÙƒÙŠØ§Ø¬","Ù…Ù„Ø§Ø¨Ø³","Ø§Ù„Ù…Ù†Ø²Ù„","Ø£ÙØ±Ø§Ø­","Ø£Ø®Ø±Ù‰"];

function normalizeString(s){ return s? String(s).trim() : ""; }
function parseNumberCell(v){ if(!v) return 0; const n=parseFloat(String(v).replace(/[^\d,.\-]/g,"").replace(",",".")); return isNaN(n)?0:n; }
function mapToCanonicalCategory(str){
  const s = normalizeString(str).toLowerCase();
  if(!s) return "Ø£Ø®Ø±Ù‰";
  if(s.includes("Ø­Ù‚ÙŠ") || s.includes("Ø´Ù†Ø·") || s.includes("Ø´Ù†Ø·Ù‡") || s.includes("Ø­Ù‚ÙŠØ¨Ø©")) return "Ø­Ù‚Ø§Ø¦Ø¨";
  if(s.includes("Ù…ÙˆØ¨Ø§ÙŠÙ„") || s.includes("Ù‡Ø§ØªÙ") || s.includes("mobile") || s.includes("phone")) return "Ù…ÙˆØ¨Ø§ÙŠÙ„";
  if(s.includes("Ø§ÙƒØ³") || s.includes("Ø¥ÙƒØ³") || s.includes("access")) return "Ø§ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª";
  if(s.includes("Ù…ÙƒÙŠØ§Ø¬") || s.includes("ØªØ¬Ù…ÙŠÙ„") || s.includes("makeup")) return "Ù…ÙƒÙŠØ§Ø¬";
  if(s.includes("Ù…Ù„Ø§Ø¨Ø³") || s.includes("Ù„Ø¨Ø³") || s.includes("clothes") || s.includes("fashion")) return "Ù…Ù„Ø§Ø¨Ø³";
  if(s.includes("Ù…Ù†Ø²Ù„") || s.includes("Ø¨ÙŠØª") || s.includes("home") || s.includes("house")) return "Ø§Ù„Ù…Ù†Ø²Ù„";
  if(s.includes("ÙØ±Ø­") || s.includes("Ø§ÙØ±Ø§Ø­") || s.includes("Ø²ÙØ§Ù") || s.includes("wedding")) return "Ø£ÙØ±Ø§Ø­";
  return s||"Ø£Ø®Ø±Ù‰";
}

window.importExcel = async function(){
  const input = document.getElementById("excelFile");
  const file = input.files[0];
  const msg = document.getElementById("uploadMsg");
  msg.innerText = "";
  if(!file){ msg.innerText = "Ø§Ø®ØªØ± Ù…Ù„Ù Excel (.xlsx) Ø£ÙˆÙ„Ø§Ù‹."; return; }
  try{
    const arrayBuffer = await file.arrayBuffer();
    const workbook = XLSX.read(arrayBuffer,{type:'array'});
    const sheet = workbook.Sheets[workbook.SheetNames[0]];
    const rows = XLSX.utils.sheet_to_json(sheet,{header:1,defval:""});
    if(rows.length<=1){ msg.innerText="Ø§Ù„Ù…Ù„Ù ÙØ§Ø±Øº Ø£Ùˆ Ù„ÙŠØ³ Ø¨ØµÙŠØºØ© ØµØ­ÙŠØ­Ø©."; return; }
    const fallback = { name:1, notes:2, qty:3, category:4, color:5, code:6, price:7, image:8 };
    let added = 0;
    for(let r=1;r<rows.length;r++){
      const row = rows[r]||[];
      const name=normalizeString(row[fallback.name]||"");
      if(!name) continue;
      const qty=parseNumberCell(row[fallback.qty]);
      const category=mapToCanonicalCategory(row[fallback.category]||"");
      const color=normalizeString(row[fallback.color]||"");
      const code=normalizeString(row[fallback.code]||"");
     const price = parseNumberCell(row[fallback.price]);
     const image = normalizeString(row[fallback.image] || "");

     const newRef = push(ref(db,"inventory"));
await set(newRef,{
  name,
  quantity: qty,
  category,
  color,
  code,
  price,
  image
});

    }
    msg.innerText=`âœ… ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${added} Ù…Ù†ØªØ¬Ù‹Ø§ Ø¨Ù†Ø¬Ø§Ø­.`;
    input.value="";
  }catch(err){ console.error(err); msg.innerText="Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù."; }
};

function renderProducts(sectionsOrder=canonicalSections){
  const container = document.getElementById("productsContainer");
  container.innerHTML="";
  sectionsOrder.forEach(sec=>{
    const div = document.createElement("div");
    div.className="section card";
    div.id=sec;
    div.innerHTML=`<h2>${sec} <span class="count" id="count-${sec}">(0)</span></h2><div class="products-grid" id="grid-${sec}"></div>`;
    container.appendChild(div);
  });
}

function loadAndDisplay(){
  renderProducts();
  const pRef = ref(db,"inventory");
  onValue(pRef,(snap)=>{
    const counts={};
    canonicalSections.forEach(s=>counts[s]=0);
    canonicalSections.forEach(sec=>{ const g=document.getElementById("grid-"+sec); if(g) g.innerHTML=""; });
    if(!snap.exists()) return;
    snap.forEach(child=>{
      const id=child.key;
      const p=child.val();
      const cat=mapToCanonicalCategory(p.category||p.type||"");
      const sec=canonicalSections.includes(cat)?cat:"Ø£Ø®Ø±Ù‰";
      const grid=document.getElementById("grid-"+sec);
      if(!grid) return;
      const card=document.createElement("div");
      card.className="product";
     card.innerHTML=`
  ${p.image ? `<img src="${p.image}" class="product-img" alt="${p.name}">` : ``}
  <h3>${p.name}</h3>
  <div>Ø§Ù„ÙƒÙ…ÙŠØ©: <strong>${p.quantity}</strong> â€” Ø§Ù„Ø³Ø¹Ø±: <strong>${p.price}</strong> LYD</div>
  <div>Ø§Ù„Ù„ÙˆÙ†: ${p.color||"-"} â€” Ø§Ù„ÙƒÙˆØ¯: ${p.code||"-"}</div>
  <div class="q-controls">
    <button class="ghost" onclick="decrease('${id}',1)">-</button>
    <button class="ghost" onclick="increase('${id}',1)">+</button>
    <button class="ghost" onclick="deleteProduct('${id}')">Ø­Ø°Ù</button>
  </div>`;

      grid.appendChild(card);
      counts[sec]=(counts[sec]||0)+1;
    });
    canonicalSections.forEach(sec=>{
      const el=document.getElementById("count-"+sec);
      if(el) el.textContent=`(${counts[sec]||0})`;
    });
  });
}

window.deleteProduct=function(id){ if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) remove(ref(db,"inventory/"+id)); };
window.decrease=function(id,n){ if(!n||n<=0) n=1; const r=ref(db,"inventory/"+id); onValue(r,snap=>{ if(!snap.exists()) return; const cur=Number(snap.val().quantity||0); const next=cur-n; if(next<=0){ if(confirm("Ø§Ù„ÙƒÙ…ÙŠØ© Ø³ØªØµØ¨Ø­ ØµÙØ±. Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ØŸ")) remove(r); } else update(r,{quantity:next}); },{onlyOnce:true}); };
window.increase=function(id,n){ if(!n||n<=0) n=1; const r=ref(db,"inventory/"+id); onValue(r,snap=>{ if(!snap.exists()) return; const cur=Number(snap.val().quantity||0); update(r,{quantity:cur+n}); },{onlyOnce:true}); };
window.scrollToSection=function(id){ const el=document.getElementById(id); if(el) el.scrollIntoView({behavior:"smooth"}); };
window.exportToExcel = async function(){
  const pRef = ref(db,"inventory");
  const snap = await new Promise(resolve => onValue(pRef, resolve, {onlyOnce:true}));

  if(!snap.exists()){
    alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§");
    return;
  }

  const data = [["Ø§Ù„Ø§Ø³Ù…","Ø§Ù„ÙƒÙ…ÙŠØ©","Ø§Ù„ØªØµÙ†ÙŠÙ","Ø§Ù„Ù„ÙˆÙ†","Ø§Ù„ÙƒÙˆØ¯","Ø§Ù„Ø³Ø¹Ø±","Ø§Ù„ØµÙˆØ±Ø©"]];

  snap.forEach(child=>{
    const p = child.val();
    data.push([
      p.name || "",
      p.quantity || 0,
      p.category || "",
      p.color || "",
      p.code || "",
      p.price || 0,
      p.image || ""
    ]);
  });

  const ws = XLSX.utils.aoa_to_sheet(data);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Ø§Ù„Ù…Ø®Ø²ÙˆÙ†");

  XLSX.writeFile(wb, "Ø§Ù„Ù…Ø®Ø²ÙˆÙ†_Ø§Ù„Ø­Ø§Ù„ÙŠ.xlsx");
};

renderProducts();
loadAndDisplay();
const scrollBtn = document.getElementById("scrollTopBtn");

window.addEventListener("scroll", () => {
  if (window.scrollY > 300) {
    scrollBtn.style.display = "block";
  } else {
    scrollBtn.style.display = "none";
  }
});
scrollBtn.addEventListener("click", () => {
  window.scrollTo({ top: 0, behavior: "smooth" });
});
</script>
<button id="scrollTopBtn" title="Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„Ø£Ø¹Ù„Ù‰">â¬†</button>
</body>
</html>











