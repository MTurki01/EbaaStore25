<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø§Ù„Ø·Ù„Ø¨ÙŠØ§Øª - EbaaStore25</title>
<style>
:root{
  --main-purple: #6C4370;
  --accent: #87588A;
  --accent-2: #9F6D99;
  --accent-3: #B78AA7;
  --background: #E0C9C9;
  --text: #2b2b2b;
  --white: #ffffff;
}

*{box-sizing:border-box;}
body{
  margin:0;
  font-family:"Arial",sans-serif;
  background: var(--background);
  color: var(--text);
  display:flex;
  justify-content:center;
  padding:20px;
}
.wrapper{width:100%; max-width: 940px; text-align:center;}

header{
  background: linear-gradient(90deg, var(--main-purple), var(--accent-2));
  padding: 18px;
  border-radius: 10px;
  margin-bottom: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.06);
}
header h1{ margin:0; color: #4e4e4e; font-size:26px; letter-spacing:0.5px; }
nav{ margin-top:10px; display:flex; flex-wrap:wrap; justify-content:center; gap:6px; }
nav a{
  color:#686868;
  text-decoration:none;
  margin:0;
  background: rgba(255,255,255,0.15);
  padding:8px 12px;
  border-radius:8px;
  font-weight:600;
  transition: all 0.2s ease;
}
nav a:hover{ background: rgba(255,255,255,0.3); transform: translateY(-1px); }

.section-buttons{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:8px;
  margin:12px 0;
}
.section-buttons button{
  background: var(--accent-2);
  border:none;
  color:white;
  padding:8px 14px;
  border-radius:8px;
  cursor:pointer;
  font-weight:600;
  transition: all 0.2s ease;
}
.section-buttons button:hover{ background: var(--accent-3); transform: translateY(-2px); }

.card{
  background: #fff;
  padding:18px;
  border-radius:10px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.05);
  margin-bottom:18px;
  width:100%;
}

.products-grid{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:14px;
  padding-top:8px;
}
.product{
  flex:1 1 160px;
  max-width:160px;
  background: var(--accent-2);
  color:#fff;
  border-radius:10px;
  padding:8px;
  text-align:center;
  border:1px solid #87588A;
  display:flex;
  flex-direction: column;
  justify-content: space-between;
  font-size:13px;
}
.product h3{ margin:6px 0 4px 0; font-size:14px; }
.product p{ margin:4px 0; font-weight:600; }
.product .small{ font-size:12px; color:#f3e8f0; }
.product-img{ width:100%; height:100px; object-fit:cover; border-radius:6px; margin-bottom:6px; }

.q-controls{
  display:flex;
  gap:6px;
  justify-content:center;
  margin-top:6px;
  flex-wrap:wrap;
}
.q-controls button{
  padding:4px 6px;
  border-radius:6px;
  border:none;
  cursor:pointer;
  flex:1 1 40%;
  background:#fff;
  color: var(--accent-2);
  font-weight:600;
  font-size:12px;
  transition: 0.2s;
}
.q-controls button:hover{ background: #f3e8f0; }

input[type="text"], input[type="tel"], input[type="number"]{
  padding:8px;
  border-radius:6px;
  border:1px solid #ccc;
  margin:4px 6px;
}
button.primary{ background: var(--accent-2); color:#fff; border:none; padding:8px 14px; border-radius:6px; cursor:pointer; font-weight:600; }
.alert{color:red; margin-top:6px; font-weight:600; text-align:center;}
.table-list{list-style:none; padding:0;}
.table-list li{margin-bottom:10px; background:#f3e8f0; padding:8px; border-radius:6px; text-align:right; font-size:13px;}

#scrollTopBtn {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  border: none;
  background: var(--main-purple);
  color: white;
  font-size: 20px;
  cursor: pointer;
  box-shadow: 0 4px 10px rgba(0,0,0,0.25);
  display: none;
  z-index: 999;
  transition: opacity 0.3s, transform 0.3s;
}
#scrollTopBtn:hover {
 background: var(--accent-2);
  transform: translateY(-3px);
}


@media(max-width:480px){
  .product{flex:1 1 45%; max-width:45%; padding:6px; font-size:12px;}
  .product h3{font-size:13px;}
  .q-controls button{padding:3px 5px; font-size:11px;}
  .products-grid{gap:6px;}
}
</style>
</head>
<body>
<div class="wrapper">
  <button id="scrollTopBtn" title="Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø£Ø¹Ù„Ù‰">â¬†</button>

  <header class="card">
    <h1>Ø§Ù„Ø·Ù„Ø¨ÙŠØ§Øª</h1>
    <nav>
      <a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
      <a href="inventory.html">Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</a>
      <a href="Orders.html">Ø§Ù„Ø·Ù„Ø¨ÙŠØ§Øª</a>
      <a href="finances.html">Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª ÙˆØ§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</a>
    </nav>
  </header>

  <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ù‚Ø³Ø§Ù… -->
  <div class="section-buttons">
    <button onclick="filterCategory('Ø­Ù‚Ø§Ø¦Ø¨')">Ø­Ù‚Ø§Ø¦Ø¨</button>
    <button onclick="filterCategory('Ù…ÙˆØ¨Ø§ÙŠÙ„')">Ù…ÙˆØ¨Ø§ÙŠÙ„</button>
    <button onclick="filterCategory('Ø§ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª')">Ø§ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª</button>
    <button onclick="filterCategory('Ù…ÙƒÙŠØ§Ø¬')">Ù…ÙƒÙŠØ§Ø¬</button>
    <button onclick="filterCategory('Ù…Ù„Ø§Ø¨Ø³')">Ù…Ù„Ø§Ø¨Ø³</button>
    <button onclick="filterCategory('Ù…Ù†Ø²Ù„')">Ù…Ù†Ø²Ù„</button>
    <button onclick="filterCategory('Ø£ÙØ±Ø§Ø­')">Ø£ÙØ±Ø§Ø­</button>
    <button onclick="filterCategory('Ø£Ø®Ø±Ù‰')">Ø£Ø®Ø±Ù‰</button>
  </div>

  <div id="productsContainer"></div>

  <div class="card">
    <input type="text" id="customerName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†">
    <input type="tel" id="customerPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
    <input type="text" id="customerAddress" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†">
    <button class="primary" onclick="confirmOrder()">âœ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</button>
    <div id="orderMsg" class="alert"></div>
  </div>

  <div class="card">
    <h2>Ø³Ø¬Ù„ Ø§Ù„Ø·Ù„Ø¨ÙŠØ§Øª</h2>
    <ul id="ordersList" class="table-list"></ul>
  </div>

  <!-- Ø²Ø± ØªØµØ¯ÙŠØ± Ø§Ù„Ø·Ù„Ø¨Ø§Øª -->
  <div class="card">
    <button class="primary" id="exportExcelBtn">â¬‡ ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Excel</button>
  </div>
</div>




<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
import { getDatabase, ref, push, set, onValue, update, get, remove } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "ebaastore25.firebaseapp.com",
  databaseURL: "https://ebaastore25-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "ebaastore25",
  storageBucket: "ebaastore25.appspot.com",
  messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
  appId: "YOUR_APP_ID"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
// --- Ù‡Ù†Ø§ ØªØ¶ÙŠÙ Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù… ---
const TELEGRAM_BOT_TOKEN = "8380723763:AAHmXFMPzd0OOKnyFtRynYDuOAtwz-tEXk";
const TELEGRAM_CHAT_ID = "-1003663905830";

async function sendOrderToTelegram(order) {
  const { customer, phone, address, items, total } = order;

  let productsText = items.map(it => `${it.name} x${it.qty}`).join("\n");

  const message = `ğŸ“¦ Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† EbaaStore\n\n` +
                  `ğŸ‘¤ Ø§Ù„Ø§Ø³Ù…: ${customer}\n` +
                  `ğŸ“ Ø§Ù„Ø±Ù‚Ù…: ${phone}\n` +
                  `ğŸ  Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${address}\n` +
                  `ğŸ›’ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:\n${productsText}\n\n` +
                  `ğŸ’° Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total} LYD`;

  try {
    const url = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;
    await fetch(url, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        chat_id: TELEGRAM_CHAT_ID,
        text: message
      })
    });
    console.log("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ù„Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù… âœ…");
  } catch (err) {
    console.error("Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù…:", err);
  }
}
const sections = ["Ø­Ù‚Ø§Ø¦Ø¨","Ù…ÙˆØ¨Ø§ÙŠÙ„","Ø§ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª","Ù…ÙƒÙŠØ§Ø¬","Ù…Ù„Ø§Ø¨Ø³","Ù…Ù†Ø²Ù„","Ø£ÙØ±Ø§Ø­","Ø£Ø®Ø±Ù‰"];
let productsCache = {};

function normalizeString(s){ return s? String(s).trim() : ""; }
function mapToCategory(str){
  const s = normalizeString(str).toLowerCase();
  if(!s) return "Ø£Ø®Ø±Ù‰";
  if(s.includes("Ø­Ù‚Ø§Ø¦Ø¨") || s.includes("Ø´Ù†Ø·")) return "Ø­Ù‚Ø§Ø¦Ø¨";
  if(s.includes("Ù…ÙˆØ¨Ø§ÙŠÙ„") || s.includes("Ù‡Ø§ØªÙ")) return "Ù…ÙˆØ¨Ø§ÙŠÙ„";
  if(s.includes("Ø§ÙƒØ³") || s.includes("Ø¥ÙƒØ³")) return "Ø§ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª";
  if(s.includes("Ù…ÙƒÙŠØ§Ø¬") || s.includes("ØªØ¬Ù…ÙŠÙ„")) return "Ù…ÙƒÙŠØ§Ø¬";
  if(s.includes("Ù…Ù„Ø§Ø¨Ø³")) return "Ù…Ù„Ø§Ø¨Ø³";
  if(s.includes("Ù…Ù†Ø²Ù„")) return "Ù…Ù†Ø²Ù„";
  if(s.includes("Ø£ÙØ±Ø§Ø­")) return "Ø£ÙØ±Ø§Ø­";
  return "Ø£Ø®Ø±Ù‰";
}

// Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù‚Ø³Ù…Ø© Ø­Ø³Ø¨ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
function renderProducts(){
  const container = document.getElementById("productsContainer");
  container.innerHTML = "";
  sections.forEach(sec=>{
    const div = document.createElement("div");
    div.className = "card section";
    div.id = `sec-${sec}`;
    div.innerHTML = `<h2>${sec}</h2><div class="products-grid" id="grid-${sec}"></div>`;
    container.appendChild(div);
  });

  const pRef = ref(db,"inventory");
  onValue(pRef,(snap)=>{
    productsCache = {};
    sections.forEach(sec=>{ const g=document.getElementById("grid-"+sec); if(g) g.innerHTML=""; });
    if(!snap.exists()) return;

    snap.forEach(child=>{
      const id = child.key;
      const p = child.val();
      const cat = mapToCategory(p.category||p.type||"");
      const sec = sections.includes(cat)?cat:"Ø£Ø®Ø±Ù‰";
      const grid = document.getElementById("grid-"+sec);
      if(!grid) return;
      productsCache[id] = p;

      const card = document.createElement("div");
      card.className="product";
     card.innerHTML = `
  ${p.image ? `<img src="${p.image}" class="product-img" alt="${p.name}">` : ``}
  <h3>${p.name}</h3>
  <div class="small">${p.notes||""}</div>
  <div>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø©: <strong>${p.quantity}</strong></div>
  <div>Ø§Ù„Ø³Ø¹Ø±: <strong>${p.price}</strong> </div>
  <div>Ø§Ù„Ù„ÙˆÙ†: <strong>${p.color || "-"}</strong></div>
  <div class="q-controls">
    <button onclick="decreaseQty('${id}')">-</button>
    <input type="number" id="qty-${id}" value="0" min="0" style="width:50px; text-align:center;">
    <button onclick="increaseQty('${id}')">+</button>
  </div>`;

      grid.appendChild(card);
    });
  });
}

// ÙÙ„ØªØ±Ø© Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
window.filterCategory = function(cat){
  sections.forEach(sec=>{
    const el = document.getElementById(`sec-${sec}`);
    if(el) el.style.display = (sec===cat)?'block':'none';
  });
}

// ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒÙ…ÙŠØ©
window.increaseQty = function(id){ const el=document.getElementById(`qty-${id}`); if(el) el.value=Number(el.value||0)+1; }
window.decreaseQty = function(id){ const el=document.getElementById(`qty-${id}`); if(el) el.value=Math.max(0, Number(el.value||0)-1); }

// ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨
window.confirmOrder = async function(){
  const name = document.getElementById("customerName").value.trim();
  const phone = document.getElementById("customerPhone").value.trim();
  const address = document.getElementById("customerAddress").value.trim();
  if(!name){ alert("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†"); return; }
  if(!phone){ alert("Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ"); return; }
  if(!address){ alert("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†"); return; }

  const items = [];
  let total = 0;
  for(const id in productsCache){
    const q = Number(document.getElementById(`qty-${id}`)?.value||0);
    if(q>0){
      const prod = productsCache[id];
      if(q>prod.quantity){ alert(`Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„Ù…Ù†ØªØ¬ "${prod.name}" Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ù…ØªØ§Ø­`); return; }
      items.push({id,name:prod.name,qty:q,price:prod.price});
      total += q*Number(prod.price);
    }
  }
  if(items.length===0){ alert("Ø§Ø®ØªØ± Ù…Ù†ØªØ¬Ù‹Ø§ ÙˆØ§Ø­Ø¯Ù‹Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„"); return; }

  // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙ…ÙŠØ§Øª ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
  for(const it of items){
    const prodRef = ref(db,`inventory/${it.id}`);
    const snap = await get(prodRef);
    if(!snap.exists()){ alert(`Ø§Ù„Ù…Ù†ØªØ¬ ${it.name} ØºÙŠØ± Ù…ØªØ§Ø­`); return; }
    const cur = Number(snap.val().quantity||0);
    const next = cur - it.qty;
    if(next<=0){ await set(prodRef,null); } else { await update(prodRef,{quantity:next}); }
  }

  // Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨
  const newRef = push(ref(db,"orders"));
  await set(newRef,{customer:name,phone,address,items,total,date:new Date().toLocaleString()});
  await sendOrderToTelegram({ customer, phone, address, items, total });

  alert("ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ âœ…");
  document.getElementById("customerName").value="";
  document.getElementById("customerPhone").value="";
  document.getElementById("customerAddress").value="";
  for(const it of items){ const el=document.getElementById(`qty-${it.id}`); if(el) el.value=0; }

  loadOrders();
}

// Ø¹Ø±Ø¶ Ø³Ø¬Ù„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
function loadOrders(){
  const oRef = ref(db,"orders");
  onValue(oRef,(snap)=>{
    const list = document.getElementById("ordersList");
    list.innerHTML="";
    if(!snap.exists()) return;
    snap.forEach(child=>{
      const o = child.val();
      const li = document.createElement("li");
      li.innerHTML=`<div style="text-align:right;">
        <strong>${o.customer}</strong> â€” Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ: ${o.phone} â€” Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${o.address} â€” ${o.date} <br> Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${o.total} LYD
        <div style="font-size:13px; color:#6b5b5f; margin-top:6px;">
          ${o.items.map(it=>`${it.name} x${it.qty}`).join(" ØŒ ")}
        </div>
      </div>`;
      list.appendChild(li);
    });
  });
}

// Ø²Ø± ØªØµØ¯ÙŠØ± Ø§Ù„Ø·Ù„Ø¨Ø§Øª
// Ø²Ø± ØªØµØ¯ÙŠØ± Ø§Ù„Ø·Ù„Ø¨Ø§Øª (Excel)
document.getElementById("exportExcelBtn").addEventListener("click", async function() {
  const oRef = ref(db,"orders");
  const snap = await get(oRef);
  if(!snap.exists()){ alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø¨ÙŠØ§Øª Ù„Ù„ØªØµØ¯ÙŠØ±"); return; }

  let csvContent = "Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†,Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ,Ø§Ù„Ø¹Ù†ÙˆØ§Ù†,ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨,Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª,Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨\n";

  snap.forEach(child=>{
    const o = child.val();
    const productsStr = o.items.map(it=>`${it.name} x${it.qty}`).join(" ØŒ ");
    csvContent += `"${o.customer}","${o.phone}","${o.address}","${o.date}","${productsStr}","${o.total}"\n`;
  });

  const blob = new Blob(["\uFEFF" + csvContent], { type: "text/csv;charset=utf-8;" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "Orders.csv";
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
});


// Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø£Ø¹Ù„Ù‰
// Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±
const scrollBtn = document.getElementById("scrollTopBtn");

// Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø²Ø± ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„Ù„Ø£Ø³ÙÙ„
window.onscroll = function() {
  if(document.body.scrollTop > 100 || document.documentElement.scrollTop > 100){
    scrollBtn.style.display = "block";
  } else {
    scrollBtn.style.display = "none";
  }
};

// Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ·ØŒ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø£Ø¹Ù„Ù‰ Ø¨Ø³Ù„Ø§Ø³Ø©
scrollBtn.addEventListener("click", function() {
  window.scrollTo({ top: 0, behavior: 'smooth' });
});

// Ø¥Ø®ÙØ§Ø¤Ù‡ Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
scrollBtn.style.display = "none";

renderProducts();
loadOrders();
</script>
</body>
</html>










